<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<script>

  // Example starter JavaScript for disabling form submissions if there are invalid fields
  (() => {
    'use strict'

    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    const forms = document.querySelectorAll('.needs-validation')

    // Loop over them and prevent submission
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }

        form.classList.add('was-validated')
      }, false)
    })
  })()

</script>

<script> //Script que activa o desactiva los inputs de acciones si no es necesario
  //Se asignan todos los inputs de acciones a una variable
  //let input1 = document.getElementById('accion1'); //Se almacena el input

  function desactiva(valor) { //Funcion que cambia la propiedad hidden del action de acuerdo a la respuesta
    let padre = valor.parentElement.parentElement; //Traversing the dom para encontrar el elemento row padre
    let select = padre.children[3].children[0]; //Traversing hacia el hijo posicion 3 de row
    // Valida la respuesta de la pregunta
    if (valor.value == "no") {
      select.hidden = false; //Cambia el atributo hidden de la etiqueta select
      select.value = 'si'; //Cambia el valor seleccionado por defecto
    } else {
      select.hidden = true;  //Cambia el atributo hidden de la etiqueta select
      select.value = ' ';
    }
  }

</script>

<script> //Script para habilitar o deshabilitar la camara con click de un boton
  const width = 620;    // We will scale the photo width to this
  const height = 480;     // This will be computed based on the input stream

  function mostrarOcultarVideo() {   //Se habilita o deshabilita con el click del boton se ejecuta otra funcion mostrarVideo()
    var tagVideo = document.querySelector('video'); //Se asigna el tagVideo
    var btnMostrar = document.getElementById('mostrarcamara'); //Se asigna el btnMostrar camara
    if (tagVideo.hidden == false) { //Condicion para ver si la propiedad hidden es true o false
      tagVideo.hidden = true; //Se cambia la condicion hidden para el tag de video para ocultarlo o mostrarlo
      btnMostrar.innerText = "Camara"; //Se asigna el texto al boton
      var valCerrar = { video: false, audio: false }; // se asignan valores a la funcion mostrarVideo
      mostrarVideo(valCerrar); //Se llama la funcion mostrarVideo
    } else {
      tagVideo.hidden = false; //Se cambia la condicion hidden para el tag de video para ocultarlo o mostrarlo
      btnMostrar.innerText = "Cerrar Cámara"; //Se cambia el texto al boton
      var valAbrir = { video: true, audio: false }; // se asgnan valores a la función mostrarVideo
      mostrarVideo(valAbrir); //Se llama la funcion mostrarVideo
    }
  }

  function mostrarVideo(constraints) {
    var video = document.getElementById('video');
    if (constraints.video == true) {
      console.log(constraints.video);
      navigator.mediaDevices.getUserMedia(constraints)
        .then(function (stream) {
          video.srcObject = stream;
          video.play();
        })
        .catch(function (err) {
          console.log("An error has occured: " + err);
        });
    } else {
      console.log(constraints.video);
      var videoStream = document.getElementById('video');//Se ontiene la etiqueta video      
      stream = videoStream.srcObject;//Se obtiene el stream del video
      tracks = stream.getTracks();//Se obtienen todos los strems
      tracks.forEach(function (track) { //Se recorren todos los videos de la pagina
        track.stop();//Se detiene el video del navegador
      });
      videoStream.srcObject = null;//Se asigna null el source del video
    }
  }

  function tomarFoto(){
    var photo = document.getElementById('photo');
    var video = document.getElementById('video');
    var canvas = document.getElementById('canvas');
    var context = canvas.getContext('2d');
    context.drawImage(video, 0, 0, width, height);
    var data = canvas.toDataURL('image/png');
    canvas.hidden = true;
    photo.setAttribute('src',data);
  }

</script>